<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Eye Health Analysis - BlinkWell</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="static/css/style-eye-analysis.css">
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1><i class="fas fa-eye"></i> Comprehensive Eye Health Analysis</h1>
            <p>Complete AI-powered eye health assessment combining image analysis and health questionnaire</p>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 33%"></div>
            </div>
            
            <div class="step-indicator">
                <div class="step active" id="step1">
                    <i class="fas fa-camera"></i>
                    <span>Image Analysis</span>
                </div>
                <div class="step" id="step2">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Health Questionnaire</span>
                </div>
                <div class="step" id="step3">
                    <i class="fas fa-chart-line"></i>
                    <span>Comprehensive Results</span>
                </div>
            </div>
        </div>

        <!-- Step 1: Image Analysis -->
        <div class="analysis-card" id="imageAnalysisCard">
            <div class="card-header">
                <h3>Step 1: Eye Image Analysis</h3>
                <p>Upload a clear photo of your eye for initial AI analysis</p>
            </div>

            <div class="card-content">
                <div class="upload-section">
                    <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="upload-text">Click to upload or drag and drop</div>
                        <div class="upload-subtext">PNG, JPG, JPEG files only (Max 5MB)</div>
                    </div>
                    
                    <input type="file" id="fileInput" class="file-input" accept="image/*">
                    
                    <div class="preview-container" id="previewContainer">
                        <img id="previewImage" class="preview-image" alt="Preview">
                        <br>
                        <button id="analyzeBtn" class="btn btn-primary" onclick="analyzeImage()">
                            <i class="fas fa-search"></i>
                            Analyze Image
                        </button>
                    </div>
                </div>

                <div class="message" id="imageMessage"></div>

                <div id="imageResult" style="display: none;">
                    <div class="analysis-item">
                        <h3><i class="fas fa-eye"></i> Image Analysis Result</h3>
                        <p id="imageResultText"></p>
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="btn btn-primary" onclick="proceedToQuestionnaire()">
                                <i class="fas fa-arrow-right"></i>
                                Continue to Questionnaire
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Health Questionnaire -->
        <div class="analysis-card questionnaire-section" id="questionnaireCard">
            <div class="card-header">
                <h3>Step 2: Health & Lifestyle Questionnaire</h3>
                <p>Complete this comprehensive questionnaire for detailed analysis</p>
            </div>

            <div class="card-content">
                <form id="questionnaireForm">
                    <!-- Basic Information -->
                    <div class="form-section">
                        <h3><i class="fas fa-user"></i> Basic Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="gender">Gender</label>
                                <select id="gender" name="Gender" required>
                                    <option value="">Select Gender</option>
                                    <option value="M">Male</option>
                                    <option value="F">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="age">Age</label>
                                <input type="number" id="age" name="Age" min="1" max="100" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="height">Height (cm)</label>
                                <input type="number" id="height" name="Height" min="100" max="250" required>
                            </div>
                            <div class="form-group">
                                <label for="weight">Weight (kg)</label>
                                <input type="number" id="weight" name="Weight" min="30" max="200" required>
                            </div>
                        </div>
                    </div>

                    <!-- Sleep Information -->
                    <div class="form-section">
                        <h3><i class="fas fa-bed"></i> Sleep & Rest</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sleepDuration">Sleep Duration (hours)</label>
                                <input type="number" id="sleepDuration" name="Sleep_duration" min="1" max="12" step="0.5" required>
                            </div>
                            <div class="form-group">
                                <label>Sleep Quality (1-10)</label>
                                <div class="slider-container">
                                    <span>1</span>
                                    <input type="range" id="sleepQuality" name="Sleep_quality" class="slider" min="1" max="10" value="5">
                                    <span>10</span>
                                    <div class="slider-value" id="sleepQualityValue">5</div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Do you have a sleep disorder?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="sleepDisorderY" name="Sleep_disorder" value="Y">
                                    <label for="sleepDisorderY">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="sleepDisorderN" name="Sleep_disorder" value="N" checked>
                                    <label for="sleepDisorderN">No</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Do you wake up during the night?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="wakeUpY" name="Wake_up_during_night" value="Y">
                                    <label for="wakeUpY">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="wakeUpN" name="Wake_up_during_night" value="N" checked>
                                    <label for="wakeUpN">No</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Do you feel sleepy during the day?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="sleepyDayY" name="Feel_sleepy_during_day" value="Y">
                                    <label for="sleepyDayY">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="sleepyDayN" name="Feel_sleepy_during_day" value="N" checked>
                                    <label for="sleepyDayN">No</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Health & Lifestyle -->
                    <div class="form-section">
                        <h3><i class="fas fa-heartbeat"></i> Health & Lifestyle</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Stress Level (1-10)</label>
                                <div class="slider-container">
                                    <span>1</span>
                                    <input type="range" id="stressLevel" name="Stress_level" class="slider" min="1" max="10" value="5">
                                    <span>10</span>
                                    <div class="slider-value" id="stressLevelValue">5</div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="bloodPressure">Blood Pressure</label>
                                <input type="text" id="bloodPressure" name="Blood_pressure" placeholder="e.g., 120/80" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="heartRate">Heart Rate (BPM)</label>
                                <input type="number" id="heartRate" name="Heart_rate" min="40" max="200" required>
                            </div>
                            <div class="form-group">
                                <label for="dailySteps">Daily Steps</label>
                                <input type="number" id="dailySteps" name="Daily_steps" min="0" max="50000" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Physical Activity Level (1-10)</label>
                            <div class="slider-container">
                                <span>1</span>
                                <input type="range" id="physicalActivity" name="Physical_activity" class="slider" min="1" max="10" value="5">
                                <span>10</span>
                                <div class="slider-value" id="physicalActivityValue">5</div>
                            </div>
                        </div>
                    </div>

                    <!-- Substance Use -->
                    <div class="form-section">
                        <h3><i class="fas fa-coffee"></i> Substance Use</h3>
                        <div class="form-group">
                            <label>Do you consume caffeine?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="caffeineY" name="Caffeine_consumption" value="Y">
                                    <label for="caffeineY">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="caffeineN" name="Caffeine_consumption" value="N" checked>
                                    <label for="caffeineN">No</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Do you consume alcohol?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="alcoholY" name="Alcohol_consumption" value="Y">
                                    <label for="alcoholY">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="alcoholN" name="Alcohol_consumption" value="N" checked>
                                    <label for="alcoholN">No</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Do you smoke?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="smokingY" name="Smoking" value="Y">
                                    <label for="smokingY">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="smokingN" name="Smoking" value="N" checked>
                                    <label for="smokingN">No</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medical Information -->
                    <div class="form-section">
                        <h3><i class="fas fa-stethoscope"></i> Medical Information</h3>
                        <div class="form-group">
                            <label>Do you have any medical issues?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="medicalIssueY" name="Medical_issue" value="Y">
                                    <label for="medicalIssueY">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="medicalIssueN" name="Medical_issue" value="N" checked>
                                    <label for="medicalIssueN">No</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Are you on ongoing medication?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="medicationY" name="Ongoing_medication" value="Y">
                                    <label for="medicationY">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="medicationN" name="Ongoing_medication" value="N" checked>
                                    <label for="medicationN">No</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Digital Habits -->
                    <div class="form-section">
                        <h3><i class="fas fa-mobile-alt"></i> Digital Habits</h3>
                        <div class="form-group">
                            <label for="screenTime">Average Screen Time (hours/day)</label>
                            <input type="number" id="screenTime" name="Average_screen_time" min="0" max="24" step="0.5" required>
                        </div>
                        <div class="form-group">
                            <label>Do you use smart devices before bed?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="deviceBeforeBedY" name="Smart_device_before_bed" value="Y">
                                    <label for="deviceBeforeBedY">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="deviceBeforeBedN" name="Smart_device_before_bed" value="N" checked>
                                    <label for="deviceBeforeBedN">No</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Do you use blue light filters?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="blueLightY" name="Blue_light_filter" value="Y">
                                    <label for="blueLightY">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="blueLightN" name="Blue_light_filter" value="N" checked>
                                    <label for="blueLightN">No</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Eye Symptoms -->
                    <div class="form-section">
                        <h3><i class="fas fa-eye"></i> Current Eye Symptoms</h3>
                        <div class="form-group">
                            <label>Do you experience eye strain or discomfort?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="eyeStrainY" name="Discomfort_eye_strain" value="Y">
                                    <label for="eyeStrainY">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="eyeStrainN" name="Discomfort_eye_strain" value="N" checked>
                                    <label for="eyeStrainN">No</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Do you have redness in your eyes?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="rednessY" name="Redness_in_eye" value="Y">
                                    <label for="rednessY">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="rednessN" name="Redness_in_eye" value="N" checked>
                                    <label for="rednessN">No</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Do you experience itchiness or irritation in your eyes?</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="itchinessY" name="Itchiness_irritation_in_eye" value="Y">
                                    <label for="itchinessY">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="itchinessN" name="Itchiness_irritation_in_eye" value="N" checked>
                                    <label for="itchinessN">No</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="message" id="questionnaireMessage"></div>

                    <div style="text-align: center; margin-top: 30px;">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-chart-line"></i>
                            Complete Analysis
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Step 3: Comprehensive Results -->
        <div class="analysis-card results-section" id="resultsCard">
            <div class="card-header">
                <h3>Step 3: Comprehensive Analysis Results</h3>
                <p>Your complete eye health assessment based on image and questionnaire data</p>
            </div>

            <div class="card-content">
                <div class="result-summary" id="resultSummary">
                    <div class="risk-level" id="riskLevel">Analyzing...</div>
                    <p id="riskDescription">Please wait while we process your comprehensive analysis...</p>
                </div>

                <div class="analysis-grid">
                    <div class="analysis-item">
                        <h3><i class="fas fa-camera"></i> Image Analysis</h3>
                        <div id="imageAnalysisResult">
                            <p>Probability: <span id="imageProbability">-</span></p>
                            <div class="probability-bar">
                                <div class="probability-fill" id="imageBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="analysis-item">
                        <h3><i class="fas fa-clipboard-list"></i> Questionnaire Analysis</h3>
                        <div id="questionnaireAnalysisResult">
                            <p>Probability: <span id="questionnaireProbability">-</span></p>
                            <div class="probability-bar">
                                <div class="probability-fill" id="questionnaireBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="analysis-item">
                    <h3><i class="fas fa-chart-bar"></i> Combined Analysis</h3>
                    <div id="combinedAnalysisResult">
                        <p>Final Risk Score: <span id="finalRiskScore">-</span>/100</p>
                        <p>Confidence Level: <span id="confidenceLevel">-</span></p>
                        <div class="probability-bar">
                            <div class="probability-fill" id="combinedBar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="analysis-item">
                    <h3><i class="fas fa-exclamation-triangle"></i> Risk Factors</h3>
                    <div class="risk-factors-grid" id="riskFactorsGrid">
                        <!-- Risk factors will be populated here -->
                    </div>
                </div>

                <div class="recommendations-section">
                    <div class="recommendations-header">
                        <h3><i class="fas fa-lightbulb"></i> Personalized Recommendations</h3>
                    </div>
                    <div class="recommendations-content" id="recommendationsContent">
                        <!-- Recommendations will be populated here -->
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <a href="/dashboard" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i>
                        Back to Dashboard
                    </a>
                    <button class="btn btn-secondary" onclick="showHistory()" style="margin-left: 15px;">
                        <i class="fas fa-history"></i>
                        View History
                    </button>
                </div>
            </div>
        </div>

        <!-- History Section -->
        <div class="analysis-card" id="historySection" style="display: none;">
            <div class="card-header">
                <h3>Analysis History</h3>
                <p>Your previous eye health assessments</p>
            </div>
            <div class="card-content" id="historyContent">
                <!-- History items will be populated here -->
            </div>
        </div>
    </div>

    <script src="static/js/js-eye-analysis.js"></script>
</body>
</html>